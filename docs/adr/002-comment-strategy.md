## TypeScript実装におけるコメント戦略の標準化

<b>日時: 2025-06-17</b>

### ステータス (Status)
承認済み (accepted)

### 背景 (Context)
TypeScriptプロジェクトにおいて、コードの可読性と保守性を向上させるため、一貫したコメント戦略が必要である。特に、EIP-1559オフライン署名という複雑なドメインでは、実装の意図と技術的背景を明確に伝えることが重要である。

現状では、各ファイルでコメントの記述方法が統一されておらず、将来の開発者（自分自身を含む）がコードを理解する際の障壁となっている。

### 決定事項 (Decision)
階層化されたドキュメント戦略を採用し、JSDoc形式による最小限かつ効果的なコメントを実装する。

#### 採用するコメント戦略
1. **階層化されたドキュメント戦略**
   - 詳細な技術議論: `docs/`ディレクトリに配置
   - 実装レベルのコメント: コード内でJSDoc形式により簡潔に記述
   - アーキテクチャ判断: `.cursor/rules`で設計原則として記録

2. **コメントの役割分担**
   - 関数コメント: 目的、引数、戻り値、例外の簡潔な説明
   - 複雑なロジック: なぜその実装を選択したかの理由
   - ビジネスルール: ドメイン知識の簡潔な説明

3. **冗長性回避の原則**
   - コードで自明なことは書かない
   - 「なぜ」を重視し、「何を」は最小限に
   - 外部仕様（EIP-1559等）への参照は簡潔に

#### JSDocコメント要素
- `@description`: 関数・クラス・インターフェースの目的
- `@param`: 各引数の意味と制約
- `@returns`: 戻り値の意味と形式
- `@throws`: 例外条件とエラー型

### 比較した選択肢 (Options Considered)

**Option 1: 詳細コメント戦略**
- 全ての関数に詳細なコメントを記述
- 実装の詳細まで含める
- 却下理由: 技術負債化のリスク、保守コストの増大

**Option 2: 最小限コメント戦略**
- 型システムで表現できる情報はコメント化しない
- 複雑なロジックのみコメント
- 却下理由: ドメイン知識の伝達不足、新規参加者の理解障壁

**Option 3: 階層化戦略（採用）**
- 詳細情報は外部ドキュメント、実装は簡潔なJSDoc
- 役割分担による効率的な情報伝達
- 採用理由: 保守性と可読性のバランス、技術負債回避

**Option 4: 自動生成コメント戦略**
- TypeScriptの型情報から自動生成
- 却下理由: ドメイン固有の知識を表現できない、機械的すぎる

### 結果 (Consequences)

**より簡単になること:**
- 新規開発者のオンボーディング時間短縮
- コードレビューでの意図確認が効率化
- 関数の使用方法と制約が明確化
- ドメイン知識の継承が安定化

**より困難になること:**
- 初期実装時のコメント記述コスト増加
- コード変更時のコメント同期保守が必要
- JSDoc記述ルールの習得が必要
- ビルド時にコメントが含まれることでパッケージサイズがわずかに増大する

**技術負債回避策:**
- コメントは実装の「なぜ」に焦点、「何を」は型システムに依存
- 外部仕様への参照は簡潔なリンクのみ
- 定期的なコメント品質レビューの実施 