# セキュリティ機能

### 秘密鍵保護

- **ファイル権限の強制**: `chmod 400`（所有者読み取り専用）のみを許可します。それ以外の権限が設定されたファイルを使用しようとすると、警告が表示されます。
- **拡張子検証**: `.key`拡張子を持つファイルのみを秘密鍵ファイルとして受け入れます。
- **メモリクリーンアップ**: 使用後の秘密鍵情報をメモリから安全に消去する仕組みを提供します。
- **ログ保護**: 秘密鍵やその他の機密情報がログに出力されることを防ぎます。

### 入力検証

- **Zodスキーマ**: すべてのCLI入力とトランザクションパラメータは、Zodスキーマによって厳格にバリデーションされます。
- **型安全性**: TypeScriptの`strict`モードを活用し、コンパイル時点で型の不整合を検知します。
- **包括的なエラーハンドリング**: 想定されるエラーは型付けされたカスタムエラーとして分類され、適切に処理されます。

### ネットワークセキュリティ

- **RPC URLバリデーション**: RPCエンドポイントのURLが有効な`http:`または`https:`プロトコルを使用していることを検証します。
- **チェーンID検証**: 署名時に指定されたチェーンIDとネットワーク構成を照合し、意図しないネットワークへのトランザクション送信を防ぎます。
- **リトライ制限**: Nonceの競合解決など、リトライ処理には上限が設定されており、無限ループや過剰なリクエストを防ぎます。

### 脅威モデルと対策

- **秘密鍵の漏洩**:
  - **対策**: ファイルシステムの権限（`chmod 400`）強制、拡張子検証、メモリからの即時クリーンアップ。
- **不正なトランザクション署名**:
  - **対策**: Zodによる厳格なパラメータ検証、意図しない`gasPrice`フィールドなどの拒否。
- **リプレイ攻撃**:
  - **対策**: EIP-155に準拠し、すべてのトランザクションに`chainId`を含めることを強制。
- **設定ファイルの改ざん**:
  - **対策**: ネットワーク設定ファイルなどの内部構成も、読み込み時に型安全性を検証。
